@model User
@{
    Layout = "_MyLayout";
    ViewData["Title"] = "Index";
}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-lg p-4">
                <h2 class="card-title text-center mb-4">Secure Checkout</h2>
                <form id="checkoutForm" class="row g-3" action="#" method="POST">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-body">
                                <h3 class="card-subtitle mb-3 text-muted">Shipping Information</h3>
                                <div class="mb-3">
                                    <label asp-for="FullName" class="form-label">Full Name</label>
                                    <input asp-for="FullName" autocomplete="name" required class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <input type="text" id="address" name="address" autocomplete="street-address" required class="form-control">
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label for="city" class="form-label">City</label>
                                        <input type="text" id="city" name="city" autocomplete="address-level2" required class="form-control">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="state" class="form-label">State / Province</label>
                                        <input type="text" id="state" name="state" autocomplete="address-level1" required class="form-control">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="zipCode" class="form-label">Zip Code</label>
                                        <input type="text" id="zipCode" name="zipCode" autocomplete="postal-code" required class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-body">
                                <h3 class="card-subtitle mb-3 text-muted">Payment Information</h3>
                                <div class="mb-3">
                                    <label for="cardNumber" class="form-label">Card Number</label>
                                    <input type="text" id="cardNumber" name="cardNumber" autocomplete="cc-number" required class="form-control" placeholder="XXXX XXXX XXXX XXXX" maxlength="19">
                                </div>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label for="expirationDate" class="form-label">Expiration Date</label>
                                        <input type="text" id="expirationDate" name="expirationDate" autocomplete="cc-exp" required class="form-control" placeholder="MM/YY" maxlength="5">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="cvv" class="form-label">CVV</label>
                                        <input type="text" id="cvv" name="cvv" autocomplete="cc-csc" required class="form-control" placeholder="XXX" maxlength="4">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="cardHolderName" class="form-label">Cardholder Name</label>
                                    <input type="text" id="cardHolderName" name="cardHolderName" autocomplete="cc-name" required class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg" onclick="deleteAllItems()">Place Order</button>
                    </div>
                </form>

                <div class="modal fade" id="messageBox" tabindex="-1" aria-labelledby="messageBoxLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-body text-center">
                                <p id="messageBoxContent" class="fs-5 mb-4"></p>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        function deleteAllItems() {
            if(confirm('Are you sure you want to clear your cart?')) {
                fetch('/CartItem/DeleteAll', {
                    method: 'POST',
                    // headers: {
                    //     'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    // }
                })
                .then(response => {
                    if(response.ok) {
                        window.location.reload(); // or redirect
                    }
                });
            }
        }
        const checkoutForm = document.getElementById('checkoutForm');
        const messageBox = new bootstrap.Modal(document.getElementById('messageBox'));
        const messageBoxContent = document.getElementById('messageBoxContent');

        function showMessageBox(message) {
            messageBoxContent.textContent = message;
            messageBox.show();
        }

        checkoutForm.addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent default form submission

            // Basic client-side validation
            const requiredFields = checkoutForm.querySelectorAll('[required]');
            let allFieldsFilled = true;
            requiredFields.forEach(field => {
                if (field.value.trim() === '') {
                    allFieldsFilled = false;
                    field.classList.add('is-invalid'); // Bootstrap validation class
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            if (!allFieldsFilled) {
                showMessageBox('Please fill in all required fields.');
                return;
            }

            // Simulate order placement
            console.log('Form submitted!');
            const formData = new FormData(checkoutForm);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            console.log('Collected Data:', data);

            // Simulate a successful order
            showMessageBox('Your order has been placed successfully! Thank you for your purchase.');

            // Clear form after successful submission (optional)
            checkoutForm.reset();
        });

        // Input formatting for Card Number
        document.getElementById('cardNumber').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
            value = value.replace(/(\d{4})(?=\d)/g, '$1 '); // Add space after every 4 digits
            e.target.value = value;
        });

        // Input formatting for Expiration Date (MM/YY)
        document.getElementById('expirationDate').addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });
    });
</script>